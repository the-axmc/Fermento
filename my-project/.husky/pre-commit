#!/usr/bin/env sh
set -e

# Absolute path to the hook directory (works regardless of where git commit is run)
HOOK_DIR="$(CDPATH= cd -- "$(dirname -- "$0")" && pwd)"

# If hooks live in my-project/.husky, the app dir is the parent
APP_DIR="$(dirname "$HOOK_DIR")"

# If hooks are at repo root, fall back to <repo>/my-project
if [ ! -d "$APP_DIR/node_modules/.bin" ]; then
  REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"
  APP_DIR="$REPO_ROOT/my-project"
fi

BIN="$APP_DIR/node_modules/.bin/lint-staged"

if [ ! -x "$BIN" ]; then
  echo "lint-staged not found at: $BIN" >&2
  echo "Install dependencies first: npm -C \"$APP_DIR\" i" >&2
  exit 1
fi

# Run lint-staged with the app dir as CWD so it picks the right config
exec "$BIN" --cwd "$APP_DIR"
